# [使用 git add -p 进行选择性地暂存代码](https://github.com/hadleysu/gitblog/issues/20)

# 使用 git add -p 进行选择性地暂存代码

## 简介

git add -p 是 Git 中非常有用的命令，它允许你在提交前按 "块" 或 "片段"（hunks）选择哪些代码改动需要暂存并提交，而不必把整个文件的改动一次性全部提交。这在你有多个独立改动（例如功能代码和变量名重构）但都位于同一个文件时尤为有用。

## 示例 Git 工作流

1. **暂存并提交更改：**

   - 由于在开发功能的过程中发现了变量命名问题，我需要将提交过程分开：
     - **步骤 1：** 使用 `git add -p` 来选择性暂存并仅提交变量重命名的更改。
     - **步骤 2：** 完成功能的开发后，再提交剩下的代码。

2. **提交信息：**

   - 针对重构（变量重命名）的提交信息：

     ```bash
     refactor: rename variables to improve clarity
     ```

   - 针对功能（例如：按钮功能）的提交信息：

     ```bash
     feat: implement roll dice button functionality
     ```

## 重要提示

- **使用 `git add -p`：** 这个命令允许选择性暂存，帮助保持提交干净且逻辑上分离。变量重命名更改完成后，我可以选择性地暂存代码，而不会影响未完成的功能代码。
- **提交顺序：** 优先提交重构部分，以解决变量命名问题，然后再提交功能代码，这样可以确保版本控制历史清晰一致。

## Git 使用的补充说明

1. **撤销 `git add -p`：** 如果不小心暂存了错误的块，我可以使用 `git reset` 或 `git restore --staged` 来取消暂存。

   ```bash
   git restore --staged <file>
   ```

2. **提交粒度：** 始终保持提交的焦点在单一更改上（例如：重构和功能开发分开）。这使得代码审查、调试和回滚更为简单。

---

## 关键点

- **及早发现问题：** 在实现功能的过程中，如果遇到命名或结构性问题，应尽早解决，以避免日后出现混淆。
- **分步骤提交：** 使用 `git add -p` 进行选择性暂存，确保重构和功能开发分离提交。
- **清晰的提交信息：** 使用 `feat`、`refactor` 等前缀，确保提交信息对他人明确。

---

## 对整个过程的反思

- 这一工作流可以保持开发过程的清晰和有序。通过及早发现并立即重构，项目可维护性得到了提升。通过策略性地使用 Git（如 `git add -p` 和清晰的提交信息），确保了版本控制历史反映有意义且独立的更改，这是专业开发中的关键实践。

## 补充学习

- [https://git-scm.com/docs/git-add](https://git-scm.com/docs/git-add)
